spring.application.name=planifikausersapi

# ===============================
# Server Configuration
# ===============================
server.port=${SERVER_PORT:8080}
server.servlet.context-path=${SERVER_SERVLET_CONTEXT_PATH:/api/v1}

# ===============================
# DATABASE - Supabase PostgreSQL
# ===============================
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect


spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.datasource.hikari.data-source-properties.prepareThreshold=0

# ===============================
# HikariCP Pool Tuning
# ===============================
# Nota: Ajusta los valores por variables de entorno según tu límite de conexiones
# de la base de datos (p. ej., en Supabase/pgBouncer). Mantén el total de
# conexiones por microservicio x réplicas < ~80% de max_connections.
spring.jpa.open-in-view=false
spring.datasource.hikari.pool-name=UsersApiHikariPool
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:5}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:0}
spring.datasource.hikari.connection-timeout=${HIKARI_CONNECTION_TIMEOUT:30000}
# ms a esperar por una conexión libre
spring.datasource.hikari.idle-timeout=${HIKARI_IDLE_TIMEOUT:600000}
# 10 min de inactividad antes de cerrar
spring.datasource.hikari.max-lifetime=${HIKARI_MAX_LIFETIME:1700000}
# ~28m, ligeramente menor al timeout del servidor para evitar conexiones zombis
spring.datasource.hikari.keepalive-time=${HIKARI_KEEPALIVE_TIME:0}
# 0 = desactivado; establece (p.ej. 60000) si el proveedor cierra por inactividad agresiva
spring.datasource.hikari.leak-detection-threshold=${HIKARI_LEAK_DETECTION_THRESHOLD:0}
# habilita (p.ej. 5000) SOLO temporalmente si sospechas fugas

# Logs de diagnóstico (puedes subir a DEBUG si necesitas investigar)
logging.level.com.zaxxer.hikari=${HIKARI_LOG_LEVEL:INFO}
logging.level.org.hibernate.SQL=${HIBERNATE_SQL_LOG_LEVEL:INFO}

# ===============================
# Supabase API (para consumo externo)
# ===============================
supabase.url=${SUPABASE_URL}
supabase.anon.key=${SUPABASE_ANON_KEY}
supabase.service.key=${SUPABASE_SERVICE_KEY}
supabase.jwt.secret=${SUPABASE_JWT_SECRET}

# ===============================
# General Configuration
# ===============================
spring.docker.compose.enabled=false
spring.config.import=optional:file:.env[.properties]
